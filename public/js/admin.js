// Generated by CoffeeScript 1.10.0
(function() {
  var addCheckbox, clearQuickCreate, closeQuickCreate, createQuickAddForms, fillDateSelects, getData, openQuickCreate, openSelect, quickCreate, updateSelectValue, updateTemplate;

  $(function() {
    getData();
    fillDateSelects();
    $('body').on('click', '.add', openQuickCreate);
    $('body').on('click', '.select .display', openSelect);
    $('body').on('change', '.select .options input', updateSelectValue);
    $('body').on('change', '.updateTemplate input', updateTemplate);
  });

  getData = function() {
    $('.populate').each(function(i, container) {
      var checked, model, type;
      createQuickAddForms(container);
      model = $(container).data('model');
      checked = $(container).data('checked');
      if (model === 'parentLocation') {
        model = 'location';
      }
      type = $(container).data('type');
      $.ajax({
        url: '/api/' + model + '/all/json',
        error: function(jqXHR, status, error) {
          console.log(jqXHR, status, error);
        },
        success: function(objects, status, jqXHR) {
          if (!objects) {
            return;
          }
          switch (type) {
            case 'checkboxes':
              $(objects).each(function(i, object) {
                return addCheckbox(container, object, checked);
              });
          }
          $(container).addClass('loaded');
        }
      });
    });
  };

  addCheckbox = function(container, object, checked) {
    var $clone, $input, $label;
    $clone = $(container).find('.sample').clone().removeClass('sample');
    $label = $clone.find('label');
    $input = $clone.find('input');
    $input.val(object.slug).attr('id', object.slug + 'Checkbox');
    $label.text(object.name).attr('for', object.slug + 'Checkbox');
    if (checked) {
      if (object.slug === checked || checked.indexOf(object.slug) > -1) {
        $input.attr('checked', true);
      }
    }
    $clone.attr('data-slug', object.slug).appendTo(container);
    return $clone;
  };

  openSelect = function(event) {
    var $options, $select, datetype;
    $select = $(event.target).parents('.select');
    datetype = $select.attr('data-datetype');
    $options = $select.find('.options');
    $select.siblings('.select').find('.options').removeClass('open');
    $options.toggleClass('open');
  };

  updateSelectValue = function(event) {
    var $display, $options, $select, option, value;
    option = event.target;
    value = option.value;
    $select = $(option).parents('.select');
    $options = $select.find('.options');
    $display = $select.find('.display');
    $display.html(value);
    $options.removeClass('open');
  };

  createQuickAddForms = function(container) {
    var type;
    type = $(container).data('model');
    $.ajax({
      url: '/admin/' + type + '/quick-create',
      error: function(jqXHR, status, error) {
        console.log(jqXHR, status, error);
      },
      success: function(html, status, jqXHR) {
        if (!html) {
          return;
        }
        return $('.quickCreates').append(html);
      }
    });
  };

  openQuickCreate = function(event) {
    var $addForm, $button, $cancelBtn, $module, $saveBtn, type;
    $button = $(event.target);
    type = $button.data('model');
    $module = $button.parents('.module');
    $addForm = $('.quickCreate[data-model="' + type + '"]');
    $addForm.addClass('open');
    $saveBtn = $addForm.find('input.save');
    $cancelBtn = $addForm.find('input.cancel');
    $saveBtn.click(quickCreate);
    $cancelBtn.click(closeQuickCreate);
    $('body').addClass('noScroll');
  };

  closeQuickCreate = function(event) {
    var $addForm, $button;
    event.preventDefault();
    $button = $(event.target);
    $addForm = $addForm = $button.parents('.quickCreate');
    $addForm.removeClass('open');
    $('body').removeClass('noScroll');
    clearQuickCreate($addForm);
  };

  clearQuickCreate = function(addForm) {
    $(addForm).find('input, textarea').each(function(i, input) {
      var type;
      type = $(input).attr('type');
      if (type === 'text' || input === 'password' || input === 'email') {
        return $(input).val('');
      } else if (type === 'checkbox' || type === 'radio') {
        return $(input).prop('checked', false);
      }
    });
    $(addForm).find('[data-template]').each(function(i, group) {
      return $(group).removeClass('show');
    });
  };

  quickCreate = function(event) {
    var $form, $quickCreate, checkboxes, data, postUrl, type;
    event.preventDefault();
    $quickCreate = $(event.target).parents('.quickCreate');
    $form = $quickCreate.find('form');
    postUrl = $form.attr('action');
    data = $form.serializeArray();
    type = $quickCreate.data('model');
    checkboxes = $('.checkboxes.' + type);
    $.ajax({
      type: 'POST',
      data: data,
      url: postUrl,
      dataType: 'HTML',
      error: function(jqXHR, status, error) {
        return console.log(jqXHR, status, error);
      },
      success: function(object, status, jqXHR) {
        $('body').removeClass('noScroll');
        $quickCreate.removeClass('open');
        clearQuickCreate($quickCreate);
        object = JSON.parse(object);
        addCheckbox(checkboxes, object, object.slug);
      }
    });
  };

  updateTemplate = function(event) {
    var $form, $input, value;
    $input = $(event.target);
    $form = $input.parents('form');
    value = $input.val();
    console.log($input);
    $form.find('[data-template]').removeClass('show');
    return $form.find('[data-template="' + value + '"]').addClass('show');
  };

  fillDateSelects = function() {
    return $('.date.selects').each(function(i, selects) {
      var $checkbox, $dayOptions, $monthOptions, $sample, $yearOptions, days, j, k, l, month, object, ref, results;
      $monthOptions = $(selects).find('.options.months');
      $sample = $monthOptions.find('.checkbox.sample');
      for (i = j = 0; j < 12; i = ++j) {
        month = moment.months(i);
        days = moment(i + 1, 'M').daysInMonth();
        object = {
          name: month,
          slug: month
        };
        $checkbox = addCheckbox($monthOptions, object, []);
        $checkbox.attr('data-days', days);
      }
      $dayOptions = $(selects).find('.options.days');
      $sample = $dayOptions.find('.checkbox.sample');
      for (i = k = 1; k <= 31; i = ++k) {
        object = {
          name: i,
          slug: i
        };
        $checkbox = addCheckbox($dayOptions, object, []);
      }
      $yearOptions = $(selects).find('.options.years');
      $sample = $yearOptions.find('.checkbox.sample');
      results = [];
      for (i = l = ref = moment().year(); ref <= 1899 ? l < 1899 : l > 1899; i = ref <= 1899 ? ++l : --l) {
        object = {
          name: i,
          slug: i
        };
        results.push($checkbox = addCheckbox($yearOptions, object, []));
      }
      return results;
    });
  };

}).call(this);
