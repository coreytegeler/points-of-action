// Generated by CoffeeScript 1.10.0
(function() {
  var addCheckbox, createQuickAddForms, getData, openQuickCreate, quickCreate;

  $(function() {
    getData();
    $('.add').click(openQuickCreate);
  });

  getData = function() {
    $('.populate').each(function(i, container) {
      var model, type;
      createQuickAddForms(container);
      model = $(container).data('pop-model');
      type = $(container).data('pop-type');
      $.ajax({
        url: '/api/' + model + '/all/json',
        error: function(jqXHR, status, error) {
          console.log(jqXHR, status, error);
        },
        success: function(objects, status, jqXHR) {
          if (!objects) {
            return;
          }
          switch (type) {
            case 'checkboxes':
              $(objects).each(function(i, object) {
                return addCheckbox(container, object);
              });
          }
        }
      });
    });
  };

  addCheckbox = function(container, object) {
    var $clone, $input, $label;
    $clone = $(container).find('.sample').clone().removeClass('sample');
    $label = $clone.find('span');
    $input = $clone.find('input');
    $label.attr('name', object.slug).text(object.name);
    $input.attr('name', object.slug);
    $clone.attr('data-slug', object.slug).appendTo(container);
  };

  createQuickAddForms = function(container) {
    var type;
    type = $(container).data('pop-model');
    $.ajax({
      url: '/admin/' + type + '/quick-create',
      error: function(jqXHR, status, error) {
        console.log(jqXHR, status, error);
      },
      success: function(html, status, jqXHR) {
        if (!html) {
          return;
        }
        return $('.quickCreates').append(html);
      }
    });
  };

  openQuickCreate = function(event) {
    var $addForm, $button, $module, $submit, type;
    $button = $(event.target);
    type = $button.data('model');
    $module = $button.parents('.module');
    $addForm = $('.quickCreate[data-model="' + type + '"]');
    $addForm.addClass('open');
    $submit = $addForm.find('.submit');
    $submit.click(quickCreate);
  };

  quickCreate = function(event) {
    var $form, $quickCreate, checkboxes, data, postUrl, type;
    event.preventDefault();
    $quickCreate = $(event.target).parents('.quickCreate');
    $form = $quickCreate.find('form');
    postUrl = $form.attr('action');
    data = $form.serializeArray();
    type = $quickCreate.data('model');
    checkboxes = $('.checkboxes.' + type);
    $.ajax({
      type: 'POST',
      data: data,
      url: postUrl,
      dataType: 'HTML',
      error: function(jqXHR, status, error) {
        return console.log(jqXHR, status, error);
      },
      success: function(object, status, jqXHR) {
        $quickCreate.removeClass('open');
        console.log(object);
        return addCheckbox(checkboxes, JSON.parse(object));
      }
    });
  };

}).call(this);
